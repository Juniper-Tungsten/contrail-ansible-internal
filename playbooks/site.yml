---
- name: Common system settings on base hosts
  hosts: all

  vars:
    docker_insecure_registries: >-
      {% if docker_registry_insecure is defined and docker_registry is defined %}
      {%- if docker_registry_insecure|bool and docker_registry %}
      {{ docker_registry }}{% endif %}{% endif %}
  tasks:
    - name: set /etc/hosts entry for hostname
      lineinfile: dest=/etc/hosts
        line="127.0.0.1 {{ ansible_hostname }}"

  roles:
    - role: common
    - role: docker
      tags: [contrail.containers, contrail.containers.docker]
      when: deployment_platform == "docker"

- name: Setup controller containers
  hosts: all
  roles:
    - role: common
    - role: node
      tags: [node]

- include: contrail_agent.yml
  when: contrail_compute_mode == 'bare_metal'
