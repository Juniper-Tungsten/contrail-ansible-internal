---
- name: register config node to config api server
  shell: "/usr/share/contrail-utils/provision_config_node.py --use_admin_api \
          --host_name {{ ansible_hostname }} --host_ip {{ my_controller_ip }} \
          {{ provision_cmd_keystone_args }} --oper add"

- name: register alarms to config api server
  shell: "/usr/share/contrail-utils/provision_alarm.py --use_admin_api \
          {{ provision_cmd_keystone_args }}"

- name: Create linklocal entry for metadata
  shell: "/usr/share/contrail-utils/provision_linklocal.py --use_admin_api \
          --linklocal_service_name metadata {{ provision_cmd_keystone_args }} \
          --linklocal_service_ip 169.254.169.254 --linklocal_service_port 80 \
          --ipfabric_service_ip {{ neutron_metadata_ip }} \
          --ipfabric_service_port {{ neutron_metadata_port }} --oper add"
  when: cloud_orchestrator == "openstack"

- name: Generate a default encapsulation priority
  shell: "/usr/share/contrail-utils/provision_encap.py  --use_admin_api  \
    --encap_priority {{ encap_priority }} \
    --oper add {{ provision_cmd_keystone_args }}"
