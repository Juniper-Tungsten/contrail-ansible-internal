---
- name: configure discovery DEFAULTS section
  ini_file: dest={{ discovery_conf }} section=DEFAULTS option="{{ item.key }}" value="{{ item.value }}"  create=yes
  notify:
    - restart discovery supervisord
    - restart discovery systemd
  with_dict:
    zk_server_ip: "{{ zk_server_list | join(',') }}"
    zk_server_port: "{{ zk_port }}"
    listen_ip_addr: "{{ discovery_listen_address }}"
    listen_port: "{{ discovery_listen_port }}"
    log_local: 1
    log_file: "{{ discovery_log }}"
    log_level: "{{ discovery_log_level }}"
    cassandra_server_list: "{{ configdb_servers_with_port }}"
    ttl_min: "{{ discovery_ttl_min }}"
    ttl_max: "{{ discovery_ttl_max }}"
    hc_interval: "{{ discovery_hc_interval }}"
    hc_max_miss: "{{ discovery_hc_max_miss }}"
    ttl_short: "{{ discovery_ttl_short }}"
    policy: "{{ discovery_dns_server_policy }}"
