---
- name: Copy contrail controller image
  copy:
    src: "{{ contrail_docker_image_load_path }}/{{ contrail_controller_image_archive }}"
    dest: "/tmp/{{ contrail_controller_image_archive }}"
  when: contrail_docker_registry is not defined or load_contrail_controller_image is defined

- name: "Load contrail controller image"
  docker_image:
    name: contrail-controller
    tag: "{{ contrail_version }}"
    load_path: "/tmp/{{ contrail_controller_image_archive }}"
  when: contrail_docker_registry is not defined or load_contrail_controller_image is defined

- name: "Start contrail controller container"
  docker_container:
    name: controller
    image: "{{ controller_image }}"
    privileged: true
    pid_mode: host
    network_mode: host
    state: started
    capabilities:
      - AUDIT_WRITE
    env:
      CLOUD_ORCHESTRATOR: "{{ cloud_orchestrator }}"
