- name: Wait till config api server answers
  uri:
    url: "{{ api_server_url }}"
    status_code: 200
  register: api_server_connect_status
  until: api_server_connect_status.status == 200
  retries: 180
  delay: 1

- name: register analytics to config api server (openstack)
  shell: "/usr/share/contrail-utils/provision_analytics_node.py  --api_server_ip {{ api_server_ip }}  \
    --host_name {{ ansible_hostname }} --host_ip {{ analytics_host_ip }} --oper add \
    {{ provision_cmd_keystone_args }}"
  when: cloud_orchestrator == "openstack"

- name: register vrouter to config api server (non-openstack)
  shell: "/usr/share/contrail-utils/provision_analytics_node.py  --api_server_ip {{ api_server_ip }}  \
    --host_name {{ ansible_hostname }} --host_ip {{ analytics_host_ip }} --oper add"
  when: cloud_orchestrator != "openstack"
