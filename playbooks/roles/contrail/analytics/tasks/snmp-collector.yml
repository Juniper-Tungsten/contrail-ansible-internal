---
- name: Add keystone auth config file in /etc/contrail/supervisord_analytics_files/contrail-snmp-collector.ini
  ini_file:
    dest: /etc/contrail/supervisord_analytics_files/contrail-snmp-collector.ini
    section: program:contrail-snmp-collector
    option: command
    value: '/usr/bin/contrail-snmp-collector --device-config-file /etc/contrail/device.ini -c /etc/contrail/contrail-keystone-auth.conf'
    backup: yes
  when: cloud_orchestrator == "openstack" and contrail_service_mgr == "supervisord"

- name: configure /etc/contrail/contrail-snmp-collector.conf DEFAULTS section
  ini_file: dest={{ analytics_snmp_collector_conf }} section=DEFAULTS option={{ item.key }} value={{ item.value }}  create=yes
  notify:
    - restart snmp-collector supervisord
    - restart snmp-collector systemd
  with_dict:
    zookeeper: "{{ zk_servers_with_port }}"
    log_file: "{{ analytics_snmp_collector_log }}"
    log_level: "{{ analytics_snmp_collector_log_level }}"
    log_local: "{{ log_local }}"
    http_server_port: "{{ analytics_snmp_collector_introspect_port }}"
    fast_scan_frequency: "{{ analytics_snmp_collector_fast_scan_frequency }}"
    scan_frequency: "{{ analytics_snmp_collector_scan_frequency }}"
    collectors: "{{ analytics_collectors_with_port }}"
