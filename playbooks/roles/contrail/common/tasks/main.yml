---
- name: include OS specific code
  include: "{{item}}"
  with_first_found:
    - "{{ansible_distribution}}-{{ansible_distribution_version}}.yml"
    - default.yml
  tags: [package, install]
- name: allow unauthenticated packages for ubuntu
  copy: content='APT::Get::AllowUnauthenticated "true";' dest=/etc/apt/apt.conf.d/99allowunauth owner=root group=root mode=0644
  tags: [package, install]

- name: install policy-rc.d to selectively disable automated service start by apt
  copy: src=policy-rc.d dest=/usr/sbin/policy-rc.d mode=0755
  tags: [package, install]

# This is a workaround on issue https://github.com/Juniper/contrail-docker/issues/107
- name: Add systemd-logind to /etc/sensitive_servies (WA for issue contrail-docker/107)
  lineinfile: dest=/etc/sensitive_services line=systemd-logind state=present create=yes
  tags: [package, install]

- name: Create directory /var/log/contrail
  file: path=/var/log/contrail state=directory
  tags: [package, install]

- include: keystoneauth.yml
  when: cloud_orchestrator == "openstack" and ( "'contrail-controllers' in group_names" or "'contrail-analytics' in group_names" )
  tags: [contrail.common.keystoneauth, contrail.common.keystoneauth.configure, configure]

- include: vncapi.yml
  tags: [contrail.common.vncapi, contrail.common.vncapi.configure, configure]

- name: Include systemd specific code
  include: systemd.yml
  tags: [package, install]
  when: contrail_service_mgr == 'systemd'
