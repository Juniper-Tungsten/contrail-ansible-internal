---
- name: Wait till keystone answers
  uri:
    url: "{{ keystone_admin_auth_url }}"
    status_code: 200
  register: keystone_connect_status
  until: keystone_connect_status.status == 200
  retries: 1200
  delay: 1

- name: register vrouter to config api server (openstack)
  shell: "/usr/share/contrail-utils/provision_vrouter.py  --api_server_ip {{ api_server_ip }}  \
    --host_name {{ ansible_hostname }} --host_ip {{ vhost_address }} --oper add \
    {{ provision_cmd_keystone_args }}"
  when: cloud_orchestrator == "openstack"
