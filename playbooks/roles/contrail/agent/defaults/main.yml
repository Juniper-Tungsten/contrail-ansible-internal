---
agent_packages:
  - contrail-openstack-vrouter

compile_vrouter_module: "{{ true if ansible_os_family == 'Debian' and contrail_compute_mode != 'bare_metal' else false }}"
reload_vrouter_module: false
nodemanager_conf: "/etc/contrail/contrail-vrouter-nodemgr.conf"
vrouter_physical_interface: "{{ ansible_default_ipv4.interface }}"
vrouter_physical_ansible_interface: "ansible_{{ vrouter_physical_interface | regex_replace('-', '_') }}"
vhost_interface: vhost0
vhost_ansible_interface: "ansible_{{vhost_interface}}"
vhost_address: >-
  {%- if vhost_interface in ansible_interfaces -%}{{ hostvars[inventory_hostname][vhost_ansible_interface]['ipv4']['address'] }}
  {%- else -%}{{ hostvars[inventory_hostname][vrouter_physical_ansible_interface]['ipv4']['address'] }}{%- endif -%}

vhost_netmask: >-
  {%- if vhost_interface in ansible_interfaces -%}{{ hostvars[inventory_hostname][vhost_ansible_interface]['ipv4']['netmask'] }}
  {%- else -%}{{ hostvars[inventory_hostname][vrouter_physical_ansible_interface]['ipv4']['netmask'] }}{%- endif -%}

vrouter_physical_interface_mac_address: "{{ hostvars[inventory_hostname][vrouter_physical_ansible_interface]['macaddress'] }}"
vhost_address_with_netmask: "{{ vhost_address }}/{{ vhost_netmask }}"
vhost_address_with_prefix: "{{ vhost_address_with_netmask | ipaddr('host/prefix') }}"
vhost_gateway: "{{ ansible_default_ipv4.gateway }}"
vhost_subnet: "{{ vhost_address_with_prefix | ipaddr('subnet') }}"

no_of_controllers: "{{ controller_list | length }}"
vrouter_max_control_nodes: 3
contrail_compute_mode: "container"
hypervisor: "libvirt"
