---
- name : (RedHat) proxify - create /etc/systemd/system/docker.service.d
  when: proxy_env.http_proxy is defined
  file: >
    owner=root
    group=docker
    mode=755
    path=/etc/systemd/system/docker.service.d
    state=directory

- name : (RedHat) proxify - install systemd drop-in
  when: proxy_env.http_proxy is defined
  register: docker_service_updated
  template: >
    src=etc/systemd/system/docker.service.d/http-proxy.conf.j2
    dest=/etc/systemd/system/docker.service.d/http-proxy.conf

- name : (RedHat) proxify - systemctl daemon-reload
  when: docker_service_updated.changed
  command: systemctl daemon-reload
  
- name: (RedHat) update SELinux policy for docker
  package: name=selinux-policy state=present

